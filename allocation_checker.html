<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GODS Allocation Checker</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #111;
      color: #eee;
      padding: 2rem;
    }
    h1 {
      color: #E7BB67;
    }
    .wallet-input {
      margin-bottom: 1rem;
    }
    input[type="text"] {
      padding: 0.5rem;
      width: 80%;
      max-width: 400px;
    }
    button {
      padding: 0.5rem 1rem;
      background-color: #E7BB67;
      border: none;
      color: #111;
      cursor: pointer;
      margin-left: 0.5rem;
    }
    #results {
      margin-top: 2rem;
    }
    .inscription-details {
      display: none;
      margin-top: 1rem;
    }
    .wallet-result {
      margin-bottom: 2rem;
    }
    .summary {
      margin-top: 1rem;
      padding-left: 1rem;
      color: #ccc;
    }
    #status {
      font-size: 1.2rem;
      font-weight: bold;
      margin-bottom: 1rem;
    }
    #missing-gods {
      margin-top: 1rem;
      color: #ff9999;
    }
    .status-box {
      padding: 1rem;
      margin-bottom: 1rem;
      color: #111;
      font-weight: bold;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <h1>GODS Allocation Checker</h1>
  <div id="wallets"></div>
  <button onclick="addWalletInput()">Add Wallet</button>
  <button onclick="checkAllocations()">Check Allocations</button>
  <button onclick="toggleDetails()">Toggle Extended View</button>

  <div id="results"></div>

  <script>
    const MAX_WALLETS = 5;
    let tokenData = {};
    let walletCount = 0;
    const walletsDiv = document.getElementById('wallets');
    const resultsDiv = document.getElementById('results');

    const RANKS = [
      { name: 'God Whale', tokens: 33000000, fullSet: true, color: 'gold' },
      { name: 'Whale', tokens: 33000000, fullSet: false, color: '#f7931a' },
      { name: 'Shark', tokens: 20000000, color: '#2274a5' },
      { name: 'Dolphin', tokens: 12000000, color: '#34a0a4' },
      { name: 'Fish', tokens: 6000000, color: '#52b788' },
      { name: 'Octopus', tokens: 3500000, color: '#e5989b' },
      { name: 'Crab', tokens: 1800000, color: '#ffb627' },
      { name: 'Shrimp', tokens: 672000, color: '#cdb4db' },
      { name: 'Noob', tokens: 0, color: '#444' }
    ];

    async function fetchTokenData() {
      const res = await fetch('https://raw.githubusercontent.com/GODSBRC/GODS/refs/heads/main/metadata');
      const json = await res.json();
      for (const item of json) {
        const tierAttr = item.meta.attributes.find(attr => attr.trait_type === 'Tier');
        const nameAttr = item.meta.attributes.find(attr => attr.trait_type === 'Name');
        const tokenAttr = item.meta.attributes.find(attr => attr.trait_type === 'BRC-2.0Token');

        tokenData[item.id] = {
          token: parseInt(tokenAttr?.value || 0),
          tier: tierAttr?.value || 'Unknown',
          name: nameAttr?.value || 'Unknown'
        };
      }
    }

    function addWalletInput() {
      if (walletCount >= MAX_WALLETS) return;
      const div = document.createElement('div');
      div.className = 'wallet-input';
      div.innerHTML = `<input type="text" placeholder="Enter Bitcoin address" id="wallet-${walletCount}">`;
      walletsDiv.appendChild(div);
      walletCount++;
    }

    async function checkAllocations() {
      resultsDiv.innerHTML = '';
      let total = 0;
      let allNames = new Set();
      let allValid = [];

      for (let i = 0; i < walletCount; i++) {
        const addr = document.getElementById(`wallet-${i}`).value.trim();
        if (!addr) continue;

        let cursor = '';
        while (true) {
          const res = await fetch(`https://api.hiro.so/ordinals/v1/inscriptions?address=${addr}${cursor ? `&cursor=${cursor}` : ''}`);
          const data = await res.json();
          const pageValid = data.results.filter(insc => tokenData[insc.id]);
          allValid.push(...pageValid);
          if (!data.next) break;
          cursor = data.next;
        }
      }

      if (allValid.length === 0) {
        resultsDiv.innerHTML = '<div>No GODS inscriptions found for the given wallet(s).</div>';
        return;
      }

      const walletTotal = allValid.reduce((sum, insc) => sum + tokenData[insc.id].token, 0);
      total += walletTotal;

      const tierMap = {};
      allValid.forEach(insc => {
        const info = tokenData[insc.id];
        if (!tierMap[info.tier]) tierMap[info.tier] = {};
        tierMap[info.tier][info.name] = (tierMap[info.tier][info.name] || 0) + 1;
        allNames.add(info.name);
      });

      let tierSummary = '<div class="summary"><strong>By Tier:</strong><ul>';
      Object.keys(tierMap).sort().forEach(tier => {
        tierSummary += `<li>Tier ${tier}<ul>`;
        Object.entries(tierMap[tier]).forEach(([name, count]) => {
          tierSummary += `<li>${name}: ${count}</li>`;
        });
        tierSummary += `</ul></li>`;
      });
      tierSummary += '</ul></div>';

      const walletSection = document.createElement('div');
      walletSection.className = 'wallet-result';
      walletSection.innerHTML = `<strong>Total Wallets</strong>: ${walletCount}<br><strong>Total Tokens</strong>: ${walletTotal}
        ${tierSummary}
        <div class="inscription-details">
          ${allValid.map(insc => `<div>${insc.id}: ${tokenData[insc.id].token} Tokens</div>`).join('')}
        </div>`;
      resultsDiv.appendChild(walletSection);

      const fullSet = [...allNames].length === 24;
      const rank = RANKS.find(r => total >= r.tokens && (!r.fullSet || fullSet)) || RANKS[RANKS.length - 1];

      const statusBox = document.createElement('div');
      statusBox.className = 'status-box';
      statusBox.style.backgroundColor = rank.color;
      statusBox.innerHTML = `<div id="status">You Are a ${rank.name}</div>
        <h2>Total Allocation: ${total} Tokens</h2>`;
      resultsDiv.prepend(statusBox);

      if (!fullSet) {
        const godList = ["Fehu","Uruz","Thurisaz","Ansuz","Raidho","Kenaz","Gebo","Wunjo","Hagalaz","Nauthiz","Isa","Jera","Eihwaz","Perthro","Algiz","Sowilo","Tiwaz","Berkano","Ehwaz","Mannaz","Laguz","Ingwaz","Dagaz","Othala"];
        const missing = godList.filter(name => !allNames.has(name));
        const missingDiv = document.createElement('div');
        missingDiv.id = 'missing-gods';
        missingDiv.innerHTML = `<strong>Missing Gods to God Whale Status:</strong> ${missing.join(', ')}`;
        resultsDiv.appendChild(missingDiv);
      }
    }

    function toggleDetails() {
      document.querySelectorAll('.inscription-details').forEach(div => {
        div.style.display = div.style.display === 'none' ? 'block' : 'none';
      });
    }

    window.addEventListener('DOMContentLoaded', () => {
      fetchTokenData().then(() => {
        addWalletInput();
      });
    });
  </script>
</body>
</html>
